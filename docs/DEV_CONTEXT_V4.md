# DEV CONTEXT — Orders-first Hybrid Strategy v4

**Project:** a.Group CRM
**Platform Base:** Grow CRM (Laravel-based, closed core, lead-centric)
**Deployment Model:** FTP-only shared hosting (NO SSH / NO CLI)
**Version:** 4.0

---

# ФИЛОСОФИЯ ПРОЕКТА (ОБНОВЛЁННАЯ)

Мы **НЕ пишем CRM с нуля** и **НЕ ломаем ядро Grow CRM**.

Мы строим a.Group CRM как **гибридную систему поверх Grow CRM**, используя:

- готовую инфраструктуру платформы
- существующие UX-паттерны (NX.UX, модалки, AJAX lifecycle)
- роли, ACL, permissions, policy layer
- кастомные поля
- события
- хуки
- локализацию

**Grow CRM = инфраструктурный движок**
**a.Group CRM = бизнес-логика и доменные модули поверх него**

Наша задача — использовать ядро, но не подчиняться его бизнес-ограничениям.

---

# ГЛАВНАЯ ЦЕЛЬ (УТОЧНЁННАЯ)

Построить модуль **Orders** как:

- отдельную доменную сущность
- со своей бизнес-логикой
- со своей таблицей
- со своей UI-структурой

НО:

- не разрушая lead-centric архитектуру ядра
- используя проверенные паттерны Leads / Tickets / Contracts

Итоговая модель:

> Orders — самостоятельный модуль, но технически совместимый с ядром Grow CRM.

---

# КЛЮЧЕВОЕ АРХИТЕКТУРНОЕ РЕШЕНИЕ

## Что мы поняли

- Лиды — центр ядра, это нельзя игнорировать
- Tickets и Contracts:
  - работают через NX.UX
  - имеют правильные модалки
  - используют AJAX lifecycle
  - живут без вкладок, но с расширяемой формой

- Заказы не обязаны быть лидами
- Но заказы обязаны быть совместимы с платформой

---

## Принятое решение

Мы:

- НЕ переписываем Leads
- НЕ строим Orders как клон Leads
- НЕ используем Kanban для Orders (при необходимости — заглушаем)

Вместо этого:

> Orders строятся по архитектурному паттерну Tickets / Contracts
> Связь с Leads — на дистанции, а не в ядре.

---

# АРХИТЕКТУРНЫЙ ПРИНЦИП v4

### Было (ошибка)

- слепое клонирование Leads
- попытка заставить платформу подчиниться Orders

### Стало (правильно)

- Ядро управляет жизненным циклом UI
- Мы управляем бизнес-сущностями

Интеграция через:

- Responses
- NX.UX hooks
- dom_html / dom_visibility
- существующие modal контейнеры:
  - `#cardModal`
  - `#commonModal`

---

# СРЕДА РАЗРАБОТКИ

- Локальная папка — единственный источник истины
- Только FTP
- Только SQL
- Без CLI
- Без SSH
- Без Composer
- Без NPM

(см. Version 3.1 — всё остаётся в силе)

---

# СТРОГИЕ ЗАПРЕТЫ

## Нельзя:

- править Leads controller / logic
- менять ядро Grow CRM
- ломать NX.UX lifecycle
- придумывать новые modal-контейнеры без платформенного аналога
- игнорировать существующие UX-паттерны

---

# РАЗРЕШЕНО И ПООЩРЯЕТСЯ

- Использовать Tickets / Contracts как референс
- Строить Orders как отдельный модуль
- Делать связь с Leads опциональной
- Использовать кастомные поля вместо хардкода
- Сохранять бизнес-логику Orders в собственных классах

---

# РОЛЬ ИИ В ПРОЕКТЕ

Ассистент обязан:

- мыслить в рамках платформы, а не вопреки ей
- учитывать lead-centric ядро
- предлагать гибридные решения
- возвращать ТОЛЬКО полные файлы, без точечных патчей
- помнить, что UI-жизненный цикл контролирует платформа

---

# КАРТА ДВИЖЕНИЯ (АКТУАЛЬНАЯ)

1. Зафиксировать новый DEV_CONTEXT (этот файл)
2. Переписать Module Skeleton под Orders-via-Tickets pattern
3. Привести Orders UI к совместимому виду (без Kanban)
4. Восстановить кликабельный show через `#cardModal`
5. Только после этого — развивать бизнес-логику

---

> Это новый закон проекта.
> Любое дальнейшее решение сверяется с этим документом.
